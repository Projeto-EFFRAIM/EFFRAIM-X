(self.webpackChunkeproc=self.webpackChunkeproc||[]).push([[3247],{83247:o=>{var t=o=>o&&"function"==typeof o;class a{constructor(o,t){this.topicos=Object.keys(o),this.urlGeracaoTicket=$("input[name=url_gerar_ticket]").val(),this.tentativasConexao=0,this.objTopicos=o,this.objCallback=t||{},this.host=$("input[name=url_websocket]").val()}_send(o){this.conexao.send(JSON.stringify(o))}_callbackRespostaGeracaoTicket(o){var a=this.host+"?ticket="+o.ticket;this.conexao=new WebSocket(a,["wamp"]),this.conexao.onopen=o=>{this.tentativasConexao=0,t(this.objCallback.onOpen)&&this.conexao.readyState===WebSocket.OPEN&&(this.objCallback.objCaller?(this.objCallback.onOpen.bind(this.objCallback.objCaller),this.objCallback.onOpen(o)):this.objCallback.onOpen(o)),this.topicos.forEach((o=>{this._send([5,o])}))},this.conexao.onmessage=o=>{try{var a=JSON.parse(o.data),e=a[0],s=a[1],i=a[2];8===e&&t(this.objTopicos[s])&&(this.objCallback.objCaller?this.objTopicos[s](s,i.dados,this.objCallback.objCaller):this.objTopicos[s](s,i.dados))}catch(t){console.log("Erro websocket onmessage:"+t+" Data:"+o.data)}},this.conexao.onclose=o=>{var a=this.tentativasConexao>13;o.wasClean||(a?console.error("Número de tentativas chegou ao fim. Encerrando Websocket.",o):(this.tentativasConexao++,console.debug("Tentando novamente. "+this.tentativasConexao+" tentativas até agora: ",o),setTimeout((()=>{this.conectar()}),Math.pow(Math.E,this.tentativasConexao)))),t(this.objCallback.onClose)&&(this.objCallback.onClose.bind(this.objCallback.objCaller),this.objCallback.onClose(this.tentativasConexao,a,o))}}conectar(){if(""!=this.host)return $.ajax({method:"POST",data:{strTopico:this.topicos.join(",")},url:this.urlGeracaoTicket}).then(this._callbackRespostaGeracaoTicket.bind(this))}enviarMensagem(o,t){this.conexao&&this.conexao.readyState===WebSocket.OPEN&&this._send([7,o,t,[],[]])}desconectar(){this.conexao&&this.conexao.close()}}window.ClienteWebsocket=a,o.exports=a}}]);
//# sourceMappingURL=3247.8bb6ac9bcdbce41b9548.js.map